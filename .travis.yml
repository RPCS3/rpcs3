language: cpp
compiler:
- clang
- gcc
env:
  global:
  - secure: jA29KvTCTR7q4BMzPPUBGazjJwrIWa7k4fo5ZSMlyxh2NbztZTKQYwodgDcXBoptCd1KJ9H3FXwBnNdMNVnTkvoPL9uWnN4K/3D1D20FCag1kmlBwnaVqVei5cRiZ9TOMuaxhjkdg8pcrQLTlXEEdMZf6A2OW0VgoBGDVSX9nYc=
  - secure: i5WAQh813DSjyhTcCYKxGU5ABU8ZPf0ITCO7ARPcM3/oQwhV3Q/bFtfwRVYbZXwWNmC8VKY1ZpX7JFByHjtGK9uJN1t55HCN49mC/xNVGWIozl3ZRlmbvnumLSSSX/0JCMdAmj3f+9mxF4Us0yl7M6OnVWBiOs8xekE9u/gCRzw=
  - secure: Bciblk0+nuIJie14p7FCpXOBr/08EWJizq/AORcbCt4sBC68s9Wyxz1CqKcO65sMUJ8V5rmsYjDzj2FmsGiWH3knv5h7ciax/rNxyg4wJCANaNJBJpyZhTKFaYYUrXIB0ANt1TPY+HQI3Guq3USki5PIu5q8YXXDhcaxyegahfQ=
branches:
  except:
  - ppu_recompiler
git:
  submodules: false
before_install:
- sudo service --status-all
- sudo free -m -t
- sudo /etc/init.d/mysql stop
- sudo /etc/init.d/postgresql stop
- sudo /etc/init.d/couchdb stop
- sudo /etc/init.d/redis-server stop
- sudo free -m -t
- echo "yes" | sudo apt-key adv --fetch-keys http://repos.codelite.org/CodeLite.asc
- echo "yes" | sudo apt-add-repository 'deb http://repos.codelite.org/wx3.0/ubuntu/
  precise universe'
- echo "yes" | sudo add-apt-repository 'deb http://ppa.launchpad.net/ubuntu-toolchain-r/test/ubuntu
  precise main'
- echo "yes" | sudo add-apt-repository 'deb http://llvm.org/apt/precise/ llvm-toolchain-precise-3.6
  main'
- wget -O - http://llvm.org/apt/llvm-snapshot.gpg.key | sudo apt-key add -;
- sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
- sudo apt-get update
- sudo apt-get install libwxgtk3.0-dev libopenal-dev freeglut3-dev libglew-dev libc6-dev
  llvm-3.6 llvm-3.6-dev libedit-dev
- sudo apt-get install aria2 -qq
- download_extract() { aria2c -x 16 $1 -o $2 && tar -xf $2; }
- if [ "$CXX" = "g++" ]; then sudo apt-get install -qq g++-4.9; export CXX="g++-4.9"
  CC="gcc-4.9" CXXFLAGS="-Wno-format-security"; export GCC_COLORS='error=01;31:warning=01;35:note=01;36:caret=01;32:locus=01:quote=01';
  else sudo apt-get install -qq --allow-unauthenticated clang-3.6 libstdc++-4.8-dev;
  export CXX="clang++-3.6" CC="clang-3.6"; fi;
- sudo apt-get install lib32stdc++6 -qq && aria2c -x 16 http://www.cmake.org/files/v3.0/cmake-3.0.0-Linux-i386.sh
  && chmod a+x cmake-3.0.0-Linux-i386.sh && sudo ./cmake-3.0.0-Linux-i386.sh --skip-license
  --prefix=/usr;
- sudo pip install cpp-coveralls
before_script:
- git submodule update --init asmjit ffmpeg llvm
- mkdir build
- cd build
- cmake ..
addons:
  coverity_scan:
    project:
      name: DHrpcs3/rpcs3
      description: PS3 emulator/debugger
    notification_email: raul.tambre@gmail.com
    build_command_prepend: ''
    build_command: make -j 4
    branch_pattern: coverity_scan
script:
- echo "--Shell Export Lists START--" ; export -p; echo "--Shell Export Lists STOP--";
- echo "--CXX version?"; "$CXX" --version; echo "--CXX version confirmed";
- if [ "$COVERITY_SCAN_BRANCH" != 1 ]; then make -j 4; fi
after_success:
- if [ "$COVERITY_SCAN_BRANCH" != 1 ]; then coveralls --extension .c --extension .cpp
  --extension .h; fi
- tar -cvf rpcs3.tar rpcs3/bin
- "curl --ftp-create-dirs -T rpcs3.tar -u $FTP_USER:$FTP_PASSWORD ftp://24.29.62.216/rpcs3.tar"
after_failure:
- sudo free -m -t
- sudo dmesg
